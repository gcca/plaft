'use strict';(function(d){function c(c,k){var a=c[n],a=a&&l[a];if(void 0===k)return a||r(c);if(a){if(k in a)return a[k];var h=s(k);if(h in a)return a[h]}return t.call(d(c),k)}function r(c,k,a){var h=c[n]||(c[n]=++d.uuid);c=l[h]||(l[h]=m(c));void 0!==k&&(c[s(k)]=a);return c}function m(c){var k={};d.each(c.attributes||u,function(a,h){0==h.name.indexOf("data-")&&(k[s(h.name.replace("data-",""))]=d.zepto.deserializeValue(h.value))});return k}var l={},t=d.fn.data,s=d.camelCase,n=d.expando="Zepto"+ +new Date, u=[];d.fn.data=function(p,k){return void 0===k?d.isPlainObject(p)?this.each(function(a,h){d.each(p,function(a,c){r(h,a,c)})}):0==this.length?void 0:c(this[0],p):this.each(function(){r(this,p,k)})};d.fn.removeData=function(c){"string"==typeof c&&(c=c.split(/\s+/));return this.each(function(){var k=this[n],a=k&&l[k];a&&d.each(c,function(){delete a[s(this)]})})}})(Zepto); ["width","height"].forEach(function(d){var c=d.replace(/./,function(c){return c[0].toUpperCase()});$.fn["outer"+c]=function(c){var m=this;if(m){var l=m[d]();({width:["left","right"],height:["top","bottom"]})[d].forEach(function(d){c&&(l+=parseInt(m.css("margin-"+d),10))});return l}return null}}); (function(){var d,c,r,m,l,t,s,n,u,p,k=[].slice;l=function(a,h){return null!=a?a.hasOwnProperty(h):void 0};s=function(a){return l(a,"length")&&l(a,"callee")};n=function(a){return l(a,"promise")&&"function"===typeof(null!=a?a.promise:void 0)};m=function(a){return s(a)?m(Array.prototype.slice.call(a)):!Array.isArray(a)?[a]:a.reduce(function(a,g){if(Array.isArray(g))return a.concat(m(g));a.push(g);return a},[])};c=function(a,h){return 0>=a?h():function(){if(1>--a)return h.apply(this,arguments)}};u=function(a, h){return function(){var g;g=[a].concat(Array.prototype.slice.call(arguments,0));return h.apply(this,g)}};r=function(a,h,g){var c,f,e,b;e=m(a);b=[];c=0;for(f=e.length;c<f;c++)a=e[c],b.push(a.call.apply(a,[g].concat(k.call(h))));return b};d=function(){var a,h,g,c,f,e;e="pending";c=[];f=[];g={};this.promise=function(b){var a;b=b||{};b.state=function(){return e};a=function(f,a){return function(){"pending"===e&&a.push.apply(a,m(arguments));f()&&r(arguments,g);return b}};b.done=a(function(){return"resolved"=== e},c);b.fail=a(function(){return"rejected"===e},f);b.always=function(){var e;return(e=b.done.apply(b,arguments)).fail.apply(e,arguments)};a=function(e,f){var a,g;g=new d;a=function(e,f,a){return!a?b[e](g[f]):b[e](function(){var b;b=1<=arguments.length?k.call(arguments,0):[];b=a.apply(null,b);return n(b)?b.done(g.resolve).fail(g.reject):g[f](b)})};a("done","resolve",e);a("fail","reject",f);return g};b.pipe=a;b.then=a;null==b.promise&&(b.promise=function(){return b});return b};this.promise(this);a= this;h=function(b,f,c){return function(){return"pending"===e?(e=b,g=arguments,r(f,g,c),a):this}};this.resolve=h("resolved",c);this.reject=h("rejected",f);this.resolveWith=function(b,e){return h("resolved",c,b).apply(null,e)};this.rejectWith=function(b,e){return h("rejected",f,b).apply(null,e)};return this};p=function(){var a,h,g,q,f,e,b;h=m(arguments);if(1===h.length)return n(h[0])?h[0]:(new d).resolve(h[0]).promise();f=new d;if(!h.length)return f.resolve().promise();q=[];g=c(h.length,function(){return f.resolve.apply(f, q)});h.forEach(function(b,e){if(n(b))return b.done(function(){var b;b=1<=arguments.length?k.call(arguments,0):[];q[e]=1<b.length?b:b[0];return g()});q[e]=b;return g()});e=0;for(b=h.length;e<b;e++)a=h[e],n(a)&&a.fail(f.reject);return f.promise()};t=function(a){a.Deferred=function(){return new d};a.ajax=u(a.ajax,function(a,g){var c,f,e;null==g&&(g={});f=new d;c=function(b,e){return u(b,function(){var b,f;f=arguments[0];b=2<=arguments.length?k.call(arguments,1):[];f&&f.apply(null,b);return e.apply(null, b)})};g.success=c(g.success,f.resolve);g.error=c(g.error,f.reject);e=a(g);c=f.promise();c.abort=function(){return e.abort()};return c});return a.when=p};"undefined"!==typeof exports?(exports.Deferred=function(){return new d},exports.when=p,exports.installInto=t):"function"===typeof define&&define.amd?define(function(){return"undefined"!==typeof Zepto?t(Zepto):d}):"undefined"!==typeof Zepto?t(Zepto):(this.Deferred=function(){return new d},this.Deferred.when=p,this.Deferred.installInto=t)}).call(this); (function(d){var c={isMsie:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isArray:d.isArray,isFunction:d.isFunction,isObject:d.isPlainObject,isUndefined:function(a){return"undefined"===typeof a},bind:d.proxy,bindAll:function(a){var c, g;for(g in a)d.isFunction(c=a[g])&&(a[g]=d.proxy(c,a))},indexOf:function(a,c){for(var g=0;g<a.length;g++)if(a[g]===c)return g;return-1},each:d.each,map:d.map,filter:d.grep,every:function(a,c){var g=!0;if(!a)return g;d.each(a,function(d,f){if(!(g=c.call(null,f,d,a)))return!1});return!!g},some:function(a,c){var g=!1;if(!a)return g;d.each(a,function(d,f){if(g=c.call(null,f,d,a))return!1});return!!g},mixin:d.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),defer:function(a){setTimeout(a, 0)},debounce:function(a,c,g){var d,f;return function(){var e=this,b=arguments,v;v=g&&!d;clearTimeout(d);d=setTimeout(function(){d=null;g||(f=a.apply(e,b))},c);v&&(f=a.apply(e,b));return f}},throttle:function(a,c){var g,d,f,e,b,v;b=0;v=function(){b=new Date;f=null;e=a.apply(g,d)};return function(){var z=new Date,x=c-(z-b);g=this;d=arguments;0>=x?(clearTimeout(f),f=null,b=z,e=a.apply(g,d)):f||(f=setTimeout(v,x));return e}},tokenizeQuery:function(a){return d.trim(a).toLowerCase().split(/[\s]+/)},tokenizeText:function(a){return d.trim(a).toLowerCase().split(/[\s\-_]+/)}, getProtocol:function(){return location.protocol},noop:function(){}},r=function(){var a=/\s+/;return{on:function(c,g){var d;if(!g)return this;this._callbacks=this._callbacks||{};for(c=c.split(a);d=c.shift();)this._callbacks[d]=this._callbacks[d]||[],this._callbacks[d].push(g);return this},trigger:function(c,g){var d,f;if(!this._callbacks)return this;for(c=c.split(a);d=c.shift();)if(f=this._callbacks[d])for(var e=0;e<f.length;e+=1)f[e].call(this,{type:d,data:g});return this}}}(),m=function(){function a(a){(!a|| !a.el)&&d.error("EventBus initialized without el");this.$el=d(a.el)}c.mixin(a.prototype,{trigger:function(a){var c=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+a,c)}});return a}(),l=function(){function a(f){this.prefix=["__",f,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=RegExp("^"+this.prefix)}function d(f){return JSON.stringify(c.isUndefined(f)?null:f)}var g;try{g=window.localStorage,g.setItem("~~~","!"),g.removeItem("~~~")}catch(q){g=null}c.mixin(a.prototype,g&&window.JSON? {_prefix:function(f){return this.prefix+f},_ttlKey:function(f){return this._prefix(f)+this.ttlKey},get:function(f){this.isExpired(f)&&this.remove(f);f=g.getItem(this._prefix(f));return JSON.parse(f)},set:function(f,e,b){c.isNumber(b)?g.setItem(this._ttlKey(f),d((new Date).getTime()+b)):g.removeItem(this._ttlKey(f));return g.setItem(this._prefix(f),d(e))},remove:function(f){g.removeItem(this._ttlKey(f));g.removeItem(this._prefix(f));return this},clear:function(){var f,e,b=[],a=g.length;for(f=0;f<a;f++)(e= g.key(f)).match(this.keyMatcher)&&b.push(e.replace(this.keyMatcher,""));for(f=b.length;f--;)this.remove(b[f]);return this},isExpired:function(f){f=g.getItem(this._ttlKey(f));f=JSON.parse(f);return c.isNumber(f)&&(new Date).getTime()>f?!0:!1}}:{get:c.noop,set:c.noop,remove:c.noop,clear:c.noop,isExpired:c.noop});return a}(),t=function(){function a(a){c.bindAll(this);a=a||{};this.sizeLimit=a.sizeLimit||10;this.cache={};this.cachedKeysByAge=[]}c.mixin(a.prototype,{get:function(a){return this.cache[a]}, set:function(a,c){var d;this.cachedKeysByAge.length===this.sizeLimit&&(d=this.cachedKeysByAge.shift(),delete this.cache[d]);this.cache[a]=c;this.cachedKeysByAge.push(a)}});return a}(),s=function(){function a(e){c.bindAll(this);e=c.isString(e)?{url:e}:e;f=f||new t;q=c.isNumber(e.maxParallelRequests)?e.maxParallelRequests:q||6;this.url=e.url;this.wildcard=e.wildcard||"%QUERY";this.filter=e.filter;this.replace=e.replace;this.ajaxSettings={type:"get",cache:e.cache,timeout:e.timeout,dataType:e.dataType|| "json",beforeSend:e.beforeSend};this._get=(/^throttle$/i.test(e.rateLimitFn)?c.throttle:c.debounce)(this._get,e.rateLimitWait||300)}var h=0,g={},q,f;c.mixin(a.prototype,{_get:function(e,b){function a(g){var d=c.filter?c.filter(g):g;b&&b(d);f.set(e,g)}var c=this;h<q?this._sendRequest(e).done(a):this.onDeckRequestArgs=[].slice.call(arguments,0)},_sendRequest:function(e){function b(){h--;g[e]=null;a.onDeckRequestArgs&&(a._get.apply(a,a.onDeckRequestArgs),a.onDeckRequestArgs=null)}var a=this,f=g[e],c= {url:e};f||(h++,d.extend(c,this.ajaxSettings),f=g[e]=d.ajax(c).always(b));return f},get:function(a,b){var g=this,d=encodeURIComponent(a||""),h;b=b||c.noop;d=this.replace?this.replace(this.url,d):this.url.replace(this.wildcard,d);(h=f.get(d))?c.defer(function(){b(g.filter?g.filter(h):h)}):this._get(d,b);return!!h}});return a}(),n=function(){var a,h,g,q;function f(b){c.bindAll(this);c.isString(b.template)&&!b.engine&&d.error("no template engine specified");!b.local&&(!b.prefetch&&!b.remote)&&d.error("one of local, prefetch, or remote is required"); this.name=b.name||c.getUniqueId();this.limit=b.limit||5;this.minLength=b.minLength||1;this.header=b.header;this.footer=b.footer;this.valueKey=b.valueKey||"value";this.template=e(b.template,b.engine,this.valueKey);this.local=b.local;this.prefetch=b.prefetch;this.remote=b.remote;this.itemHash={};this.adjacencyList={};this.storage=b.name?new l(b.name):null}function e(b,a,e){c.isFunction(b)||(c.isString(b)?(b=a.compile(b),b=c.bind(b.render,b)):b=function(b){return"<p>"+b[e]+"</p>"});return b}a="thumbprint"; h="protocol";g="itemHash";q="adjacencyList";c.mixin(f.prototype,{_processLocalData:function(b){this._mergeProcessedData(this._processData(b))},_loadPrefetchData:function(b){function e(d){d=b.filter?b.filter(d):d;d=f._processData(d);var v=d.itemHash,k=d.adjacencyList;f.storage&&(f.storage.set(g,v,b.ttl),f.storage.set(q,k,b.ttl),f.storage.set(a,x,b.ttl),f.storage.set(h,c.getProtocol(),b.ttl));f._mergeProcessedData(d)}var f=this,x="0.9.3"+(b.thumbprint||""),k,A,w,y;this.storage&&(k=this.storage.get(a), A=this.storage.get(h),w=this.storage.get(g),y=this.storage.get(q));k=k!==x||A!==c.getProtocol();b=c.isString(b)?{url:b}:b;b.ttl=c.isNumber(b.ttl)?b.ttl:864E5;w&&y&&!k?(this._mergeProcessedData({itemHash:w,adjacencyList:y}),w=d.Deferred().resolve()):w=d.getJSON(b.url).done(e);return w},_transformDatum:function(b){var a=c.isString(b)?b:b[this.valueKey],e=b.tokens||c.tokenizeText(a),a={value:a,tokens:e};c.isString(b)?(a.datum={},a.datum[this.valueKey]=b):a.datum=b;a.tokens=c.filter(a.tokens,function(b){return!c.isBlankString(b)}); a.tokens=c.map(a.tokens,function(b){return b.toLowerCase()});return a},_processData:function(b){var a=this,e={},f={};c.each(b,function(b,g){var d=a._transformDatum(g),h=c.getUniqueId(d.value);e[h]=d;c.each(d.tokens,function(b,a){var e=a.charAt(0),e=f[e]||(f[e]=[h]);!~c.indexOf(e,h)&&e.push(h)})});return{itemHash:e,adjacencyList:f}},_mergeProcessedData:function(b){var a=this;c.mixin(this.itemHash,b.itemHash);c.each(b.adjacencyList,function(b,e){var f=a.adjacencyList[b];a.adjacencyList[b]=f?f.concat(e): e})},_getLocalSuggestions:function(b){var a=this,e=[],f=[],g,d=[];c.each(b,function(b,a){var f=a.charAt(0);!~c.indexOf(e,f)&&e.push(f)});c.each(e,function(b,e){var c=a.adjacencyList[e];if(!c)return!1;f.push(c);if(!g||c.length<g.length)g=c});if(f.length<e.length)return[];c.each(g,function(e,g){var h=a.itemHash[g];c.every(f,function(b){return~c.indexOf(b,g)})&&c.every(b,function(b){return c.some(h.tokens,function(a){return 0===a.indexOf(b)})})&&d.push(h)});return d},initialize:function(){var b;this.local&& this._processLocalData(this.local);this.transport=this.remote?new s(this.remote):null;b=this.prefetch?this._loadPrefetchData(this.prefetch):d.Deferred().resolve();this.local=this.prefetch=this.remote=null;this.initialize=function(){return b};return b},getSuggestions:function(b,a){function e(b){d=d.slice(0);c.each(b,function(b,a){var e=f._transformDatum(a);!c.some(d,function(b){return e.value===b.value})&&d.push(e);return d.length<f.limit});a&&a(d)}var f=this,g,d,h=!1;b.length<this.minLength||(g=c.tokenizeQuery(b), d=this._getLocalSuggestions(g).slice(0,this.limit),d.length<this.limit&&this.transport&&(h=this.transport.get(b,e)),!h&&a&&a(d))}});return f}(),u=function(){function a(a){var g=this;c.bindAll(this);this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};this.$hint=d(a.hint);this.$input=d(a.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent);if(c.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function(a){g.specialKeyCodeMap[a.which||a.keyCode]||c.defer(g._compareQueryToInputValue)});else this.$input.on("input.tt",this._compareQueryToInputValue);this.query=this.$input.val();this.$overflowHelper=d("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:this.$input.css("font-family"),fontSize:this.$input.css("font-size"),fontStyle:this.$input.css("font-style"),fontVariant:this.$input.css("font-variant"),fontWeight:this.$input.css("font-weight"), wordSpacing:this.$input.css("word-spacing"),letterSpacing:this.$input.css("letter-spacing"),textIndent:this.$input.css("text-indent"),textRendering:this.$input.css("text-rendering"),textTransform:this.$input.css("text-transform")}).insertAfter(this.$input)}c.mixin(a.prototype,r,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function(a){var c=this.specialKeyCodeMap[a.which||a.keyCode];c&&this.trigger(c+"Keyed",a)},_compareQueryToInputValue:function(){var a= this.getInputValue(),c;c=this.query;var d=a;c=(c||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");d=(d||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");(c=c===d)&&this.query.length!==a.length?this.trigger("whitespaceChanged",{value:this.query}):c||this.trigger("queryChanged",{value:this.query=a})},destroy:function(){this.$hint.off(".Rq");this.$input.off(".Rq");this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query}, setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,c){this.$input.val(a);!c&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(a){this.$hint.val(a)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var a= this.$input.val().length,d=this.$input[0].selectionStart;return c.isNumber(d)?d===a:document.selection?(d=document.selection.createRange(),d.moveStart("character",-a),a===d.text.length):!0}});return a}(),p=function(){function a(a){c.bindAll(this);this.isOpen=!1;this.isEmpty=!0;this.isMouseOverDropdown=!1;this.$menu=d(a.menu).on("mouseenter",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click",".Rq-Yq",this._handleSelection).on("mouseover",".Rq-Yq",this._handleMouseover)}function h(a){return a.data("suggestion")} var g={display:"block"},q={whiteSpace:"nowrap",cursor:"pointer"},f={whiteSpace:"normal"};c.mixin(a.prototype,r,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(a){a=d(a.currentTarget);this._getSuggestions().removeClass("Rq-Zq-Ar-Br");a.addClass("Rq-Zq-Ar-Br")},_handleSelection:function(a){a=d(a.currentTarget);this.trigger("suggestionSelected",h(a))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()}, _moveCursor:function(a){var b,f;this.isVisible()&&(b=this._getSuggestions(),f=b.filter(".Rq-Zq-Ar-Br"),f.removeClass("Rq-Zq-Ar-Br"),a=b.index(f)+a,a=(a+1)%(b.length+1)-1,-1===a?this.trigger("cursorRemoved"):(-1>a&&(a=b.length-1),b=b.eq(a).addClass("Rq-Zq-Ar-Br"),this._ensureVisibility(b),this.trigger("cursorMoved",h(b))))},_getSuggestions:function(){return this.$menu.find(".Rq-Sq > .Rq-Yq")},_ensureVisibility:function(a){var b=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"), 10),f=this.$menu.scrollTop(),c=a.position().top;a=c+a.outerHeight(!0);0>c?this.$menu.scrollTop(f+c):b<a&&this.$menu.scrollTop(f+(a-b))},destroy:function(){this.$menu.off(".Rq");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.close()},close:function(){this.isOpen&&(this.isMouseOverDropdown=this.isOpen=!1,this._hide(),this.$menu.find(".Rq-Sq > .Rq-Yq").removeClass("Rq-Zq-Ar-Br"),this.trigger("closed"))}, open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(a){var b={left:"0",right:"auto"},f={left:"auto",right:" 0"};"ltr"===a?this.$menu.css(b):this.$menu.css(f)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var a=this._getSuggestions().filter(".Rq-Zq-Ar-Br").first();return 0<a.length?h(a):null},getFirstSuggestion:function(){var a=this._getSuggestions().first(); return 0<a.length?h(a):null},renderSuggestions:function(a,b){var h="Rq-Tq-"+a.name,k,l;l=this.$menu.find("."+h);var m,n,p;0===l.length&&(l=d('<span class="Rq-Sq"></span>').css(g),l=d("<div></div>").addClass(h).append(a.header).append(l).append(a.footer).appendTo(this.$menu));0<b.length?(this.isEmpty=!1,this.isOpen&&this._show(),m=document.createElement("div"),n=document.createDocumentFragment(),c.each(b,function(b,c){c.dataset=a.name;k=a.template(c.datum);m.innerHTML='<div class="Rq-Yq">%body</div>'.replace("%body", k);p=d(m.firstChild).css(q).data("suggestion",c);p.children().each(function(){d(this).css(f)});n.appendChild(p[0])}),l.show().find(".Rq-Sq").html(n)):this.clearSuggestions(a.name);this.trigger("suggestionsRendered")},clearSuggestions:function(a){a=a?this.$menu.find(".Rq-Tq-"+a):this.$menu.find('[class^="Rq-Tq-"]');var b=a.find(".Rq-Sq");a.hide();b.empty();0===this._getSuggestions().length&&(this.isEmpty=!0,this._hide())}});return a}(),k=function(){function a(a){var e,b;c.bindAll(this);var h=a.input; e=d(g.wrapper);b=d(g.dropdown);var h=d(h),l=d(g.hint);e=e.css(k.wrapper);b=b.css(k.dropdown);l.css(k.hint).css({backgroundAttachment:h.css("background-attachment"),backgroundClip:h.css("background-clip"),backgroundColor:h.css("background-color"),backgroundImage:h.css("background-image"),backgroundOrigin:h.css("background-origin"),backgroundPosition:h.css("background-position"),backgroundRepeat:h.css("background-repeat"),backgroundSize:h.css("background-size")});h.data("ttAttrs",{dir:h.attr("dir"), autocomplete:h.attr("autocomplete"),spellcheck:h.attr("spellcheck"),style:h.attr("style")});h.addClass("Rq-Wq").attr({autocomplete:"off",spellcheck:!1}).css(k.query);try{!h.attr("dir")&&h.attr("dir","auto")}catch(m){}this.$node=h.wrap(e).parent().prepend(l).append(b);this.datasets=a.datasets;this.dir=null;this.eventBus=a.eventBus;a=this.$node.find(".Rq-Bn-Ym");e=this.$node.find(".Rq-Wq");b=this.$node.find(".Rq-Xq");this.dropdownView=(new p({menu:a})).on("suggestionSelected",this._handleSelection).on("cursorMoved", this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=(new u({input:e,hint:b})).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged", this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed", this._autocomplete)}function h(a){var e=a.find(".Rq-Wq");c.each(e.data("ttAttrs"),function(a,f){c.isUndefined(f)?e.removeAttr(a):e.attr(a,f)});e.detach().removeData("ttAttrs").removeClass("Rq-Wq").insertAfter(a);a.remove()}var g={wrapper:'<span class="Ng-Vq"></span>',hint:'<input class="Rq-Xq" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="Rq-Bn-Ym"></span>'},k={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent", boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};c.isMsie()&&c.mixin(k.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});c.isMsie()&&7>=c.isMsie()&&(c.mixin(k.wrapper,{display:"inline",zoom:"1"}),c.mixin(k.query,{marginTop:"-1px"}));c.mixin(a.prototype,r,{_managePreventDefault:function(a){var c=a.data,b;b=!1;switch(a.type){case "tabKeyed":a= this.inputView.getHintValue();b=this.inputView.getInputValue();b=a&&a!==b;break;case "upKeyed":case "downKeyed":b=!c.shiftKey&&!c.ctrlKey&&!c.metaKey}b&&c.preventDefault()},_setLanguageDirection:function(){var a=this.inputView.getLanguageDirection();a!==this.dir&&(this.dir=a,this.$node.css("direction",a),this.dropdownView.setLanguageDirection(a))},_updateHint:function(){var a=this.dropdownView.getFirstSuggestion(),a=a?a.value:null,e=this.dropdownView.isVisible(),b=this.inputView.isOverflow();a&&(e&& !b)&&(e=this.inputView.getInputValue(),b=e.replace(/\s{2,}/g," ").replace(/^\s+/g,""),b=c.escapeRegExChars(b),b=RegExp("^(?:"+b+")(.*$)","i"),a=b.exec(a),this.inputView.setHintValue(e+(a?a[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(a){this.inputView.setInputValue(a.data.value, !0)},_openDropdown:function(){this.dropdownView.open()},_closeDropdown:function(a){this.dropdownView["blured"===a.type?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(a){var c=a.data;if(!c.shiftKey&&!c.ctrlKey&&!c.metaKey)this.dropdownView["upKeyed"===a.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(a){var e="suggestionSelected"===a.type,b=e?a.data:this.dropdownView.getSuggestionUnderCursor();b&&(this.inputView.setInputValue(b.value),e?this.inputView.focus(): a.data.preventDefault(),e&&c.isMsie()?c.defer(this.dropdownView.close):this.dropdownView.close(),this.eventBus.trigger("selected",b.datum,b.dataset))},_getSuggestions:function(){var a=this,e=this.inputView.getQuery();c.isBlankString(e)||c.each(this.datasets,function(b,c){c.getSuggestions(e,function(b){e===a.inputView.getQuery()&&a.dropdownView.renderSuggestions(c,b)})})},_autocomplete:function(a){var c;if("rightKeyed"===a.type||"leftKeyed"===a.type)if(c=this.inputView.isCursorAtEnd(),a="ltr"===this.inputView.getLanguageDirection()? "leftKeyed"===a.type:"rightKeyed"===a.type,!c||a)return;c=this.inputView.getQuery();a=this.inputView.getHintValue();""!==a&&c!==a&&(c=this.dropdownView.getFirstSuggestion(),this.inputView.setInputValue(c.value),this.eventBus.trigger("autocompleted",c.datum,c.dataset))},_propagateEvent:function(a){this.eventBus.trigger(a.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();h(this.$node);this.$node=null},setQuery:function(a){this.inputView.setQuery(a);this.inputView.setInputValue(a); this._clearHint();this._clearSuggestions();this._getSuggestions()}});return a}();(function(){var a={},h;h={initialize:function(g){var h;g=c.isArray(g)?g:[g];0===g.length&&d.error("no datasets provided");h=c.map(g,function(c){var d=a[c.name]?a[c.name]:new n(c);c.name&&(a[c.name]=d);return d});return this.each(function(){var a=d(this),e,b=new m({el:a});e=c.map(h,function(a){return a.initialize()});a.data("ttView",new k({input:a,eventBus:b=new m({el:a}),datasets:h}));d.when.apply(d,e).always(function(){c.defer(function(){b.trigger("initialized")})})})}, destroy:function(){return this.each(function(){var a=d(this),c=a.data("ttView");c&&(c.destroy(),a.removeData("ttView"))})},setQuery:function(a){return this.each(function(){var c=d(this).data("ttView");c&&c.setQuery(a)})}};d.extend(d.fn,{typeahead:function(a){return h[a]?h[a].apply(this,[].slice.call(arguments,1)):h.initialize.apply(this,arguments)}})})()})(window.$);
